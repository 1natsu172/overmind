import { JSDOM } from 'jsdom'
import { Overmind } from 'overmind'

import { createConnect } from './'
const Vue = require('vue/dist/vue')

const dom = new JSDOM()

describe('Vue', () => {
  it('should mount with connected app', () => {
    const config = {
      state: {
        foo: 'bar',
      },
    }
    const app = new Overmind(config)
    const connect = createConnect(app)
    const vm = new Vue(
      connect({
        el: dom.window.document.createElement('div'),
      })
    )
    expect(vm.overmind.state.foo).toBe('bar')
  })
  it('should mount with custom connected app', () => {
    const config = {
      state: {
        foo: 'bar',
      },
    }
    const app = new Overmind(config)
    const connect = createConnect(app)
    const vm = new Vue(
      connect(
        ({ state }) => ({
          state,
        }),
        {
          el: dom.window.document.createElement('div'),
        }
      )
    )
    expect(vm.state.foo).toBe('bar')
  })
  it('should expose actions', (done) => {
    const app = new Overmind({
      state: {
        foo: 'bar',
      },
      actions: {
        changeFoo: ({ state }) => (state.foo = 'bar2'),
      },
    })
    const connect = createConnect(app)
    const instance = new Vue(
      connect({
        el: dom.window.document.createElement('div'),
      })
    )
    expect(instance.overmind.state.foo).toBe('bar')
    Vue.nextTick(() => {
      instance.overmind.actions.changeFoo()
      expect(instance.overmind.state.foo).toBe('bar2')
      done()
    })
  })
})
