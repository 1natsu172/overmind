import { OnInitialize } from 'overmind'

const onInitialize: OnInitialize = async ({ state, effects }, app) => {
  state.port = effects.utils.getPort()

  effects.connector.onMessage(app.actions.onMessage)
  effects.connector.onDisconnect(app.actions.onDisconnect)

  await effects.connector.connect(state.port)

  state.actionsSplitSize =
    (await effects.storage.get('devtool.actionsSplitSize')) || 200

  state.appHost =
    (await effects.storage.get('devtool.appHost')) || null
}

export default onInitialize
