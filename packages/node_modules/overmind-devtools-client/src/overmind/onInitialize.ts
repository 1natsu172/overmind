import { OnInitialize } from 'overmind'

const onInitialize: OnInitialize = async ({ state, effects }, app) => {
  state.port = effects.utils.getPort()

  effects.connector.onMessage(app.actions.onMessage)

  await effects.connector.connect(state.port)

  const runtimeHost = await effects.storage.get<string>('runtimeHost')
  if (runtimeHost) {
    state.runtimeHost = runtimeHost
  }
}

export default onInitialize
