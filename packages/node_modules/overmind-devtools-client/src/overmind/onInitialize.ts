import { OnInitialize } from 'overmind'

const onInitialize: OnInitialize = async ({ state, effects }, app) => {
  state.port = effects.utils.getPort()

  effects.connector.onMessage(app.actions.onMessage)
  effects.connector.onDisconnect(app.actions.onDisconnect)

  await effects.connector.connect(state.port)
}

export default onInitialize
