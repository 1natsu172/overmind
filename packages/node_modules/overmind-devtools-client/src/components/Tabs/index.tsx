import { css } from 'emotion'
import { createElement } from 'overmind-components'

import { Component } from '../../overmind'
import { Tab } from '../../overmind/types'
import { colors } from '../../theme'
import Apps from '../Apps'
import Tooltip from '../common/Tooltip'
import RuntimeConfig from '../RuntimeConfig'
import * as styles from './styles'

const Tabs: Component = (_, { state, actions }) => {
  function getRuntimeColor() {
    if (state.currentApp.connectionState === 'disconnected') return colors.red
    if (state.currentApp.connectionState === 'pending') return colors.yellow

    return colors.green
  }

  return (
    <self className={styles.wrapper}>
      <Apps />
      <div className={styles.divider} />
      <div className={styles.runtimeWrapper}>
        <button
          className={css(styles.button, styles.activeButton)}
          onClick={() => actions.toggleRuntimeConfig()}
        >
          <div
            style={{
              color: getRuntimeColor(),
            }}
          />
        </button>
        {state.isShowingRuntime ? <RuntimeConfig /> : null}
      </div>
      <div className={styles.divider} />
      <Tooltip text="State">
        <button
          className={css(
            styles.button,
            state.currentTab === Tab.State && styles.activeButton
          )}
          onClick={() => actions.changeTab(Tab.State)}
        >
          <div />
        </button>
      </Tooltip>
      <Tooltip text="Actions">
        <div
          style={{ position: 'relative' }}
          className={css(styles.buttonWithCount)}
        >
          <button
            onClick={() => actions.changeTab(Tab.Actions)}
            style={{
              opacity: state.currentTab === Tab.Actions ? 1 : null,
            }}
          >
            <div />
          </button>

          <span
            className={styles.actionsCount}
            style={{
              backgroundColor: state.hasActionsError ? colors.red : null,
            }}
            onClick={() => actions.changeTab(Tab.Actions)}
          >
            {state.actionsCount}
          </span>
        </div>
      </Tooltip>
      <Tooltip text="Charts">
        <button
          className={css(
            styles.button,
            state.currentTab === Tab.Charts && styles.activeButton
          )}
          onClick={() => actions.changeTab(Tab.Charts)}
        >
          <div />
        </button>
      </Tooltip>
      <Tooltip text="Components">
        <button
          className={css(
            styles.button,
            state.currentTab === Tab.Components && styles.activeButton
          )}
          onClick={() => actions.changeTab(Tab.Components)}
        >
          <div />
        </button>
      </Tooltip>
      <Tooltip text="History">
        <button
          className={css(
            styles.button,
            state.currentTab === Tab.History && styles.activeButton
          )}
          onClick={() => actions.changeTab(Tab.History)}
        >
          <div />
        </button>
      </Tooltip>
      <Tooltip text="Flushes">
        <button
          className={css(
            styles.button,
            state.currentTab === Tab.Flushes && styles.activeButton
          )}
          onClick={() => actions.changeTab(Tab.Flushes)}
        >
          <div />
        </button>
      </Tooltip>
      {process.env.NODE_ENV === 'development' ? (
        <Tooltip text="Console">
          <button
            className={css(
              styles.button,
              state.currentTab === Tab.Console && styles.activeButton
            )}
            onClick={() => actions.changeTab(Tab.Console)}
          >
            <div />
          </button>
        </Tooltip>
      ) : null}
    </self>
  )
}

export default Tabs
