import { css } from 'emotion'
import { createElement } from 'overmind-components'
import chevronUpSvg from '@fortawesome/fontawesome-free/svgs/solid/chevron-up.svg'
import chevronDownSvg from '@fortawesome/fontawesome-free/svgs/solid/chevron-down.svg'

import { Component } from '../../overmind'
import * as textStyles from '../../styles/text'
import { colors } from '../../theme'
import * as styles from './styles'

const Components: Component = (_, { appState, actions }) => {
  function renderStats() {
    return (
      <div className={styles.statsContainer}>
        <div className={styles.panels}>
          <div className={styles.panel}>
            <span className={css(textStyles.label, textStyles.denseLabel)}>
              connected
            </span>
            <span className={css(textStyles.header, textStyles.denseHeader)}>
              {appState.componentsMounted.length}
            </span>
          </div>
          <div className={styles.panel}>
            <span className={css(textStyles.label, textStyles.denseLabel)}>
              update count
            </span>
            <span
              className={css(textStyles.header, textStyles.denseHeader)}
              style={{ color: colors.blue }}
            >
              {appState.componentsUpdateCount}
            </span>
          </div>
          <div className={styles.panel}>
            <span className={css(textStyles.label, textStyles.denseLabel)}>
              paths count
            </span>
            <span
              className={css(textStyles.header, textStyles.denseHeader)}
              style={{ color: colors.green }}
            >
              {appState.componentsStatePathCount}
            </span>
          </div>
        </div>
      </div>
    )
  }

  return (
    <self className={styles.wrapper}>
      {renderStats()}
      {Object.keys(appState.groupedComponents).map((name) => {
        const groupedComponent = appState.groupedComponents[name]

        return (
          <div key={name}>
            {groupedComponent.components.map((component) => {
              return (
                <div
                  key={component.id}
                  className={styles.component}
                  onClick={() => actions.toggleCollapsedComponent(component)}
                >
                  <div className={styles.componentName}>{component.name}</div>
                  <div
                    className={styles.componentPathsCount}
                    style={{
                      backgroundColor: colors.blue,
                    }}
                  >
                    {component.updateCount}
                  </div>
                  <div
                    className={styles.componentPathsCount}
                    style={{
                      backgroundColor:
                        component.paths.length <= 10
                          ? colors.green
                          : component.paths.length <= 20
                          ? colors.yellow
                          : colors.red,
                    }}
                  >
                    {component.paths.length}
                  </div>
                  <div className={styles.componentPaths}>
                    <div className={styles.componentPathsBody}>
                      <div className={styles.componentPathsHeader}>
                        <span className={css(textStyles.hint, styles.faded)}>
                          {component.isCollapsed ? (
                            <span key="up">{chevronUpSvg}</span>
                          ) : (
                            <span key="down">{chevronDownSvg}</span>
                          )}
                        </span>
                      </div>
                      {component.isCollapsed ? null : (
                        <div className={styles.componentPathsItems}>
                          {component.paths.map((path, index) => (
                            <span key={path}>
                              {path}
                              {index < component.paths.length - 1 ? (
                                <span className={styles.separator}>|</span>
                              ) : null}
                            </span>
                          ))}
                        </div>
                      )}
                    </div>
                  </div>
                </div>
              )
            })}
          </div>
        )
      })}
    </self>
  )
}

export default Components
