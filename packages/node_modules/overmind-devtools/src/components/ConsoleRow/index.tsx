import { createElement, FunctionComponent, useState } from 'react'
import Inspector from '../Inspector'
import * as styles from './styles'
import { AppMessage } from '../../overmind/types'

type Props = {
  message: AppMessage<any>
}

const ConsoleRow: FunctionComponent<Props> = ({ message }) => {
  const [expandedPaths, setExpandedPaths] = useState<string[]>([])

  function onToggleExpand(pathArray: string[]) {
    const expandedPathsCopy = expandedPaths.slice()
    const path = pathArray.join('.')

    if (expandedPathsCopy.includes(path)) {
      expandedPathsCopy.splice(expandedPathsCopy.indexOf(path), 1)
    } else {
      expandedPathsCopy.push(path)
    }

    setExpandedPaths(expandedPathsCopy)
  }

  return (
    <div className={styles.wrapper}>
      <div className={styles.type}>{message.type}</div>
      <Inspector
        value={message.data}
        expandedPaths={expandedPaths}
        onToggleExpand={onToggleExpand}
      />
    </div>
  )
}

export default ConsoleRow
