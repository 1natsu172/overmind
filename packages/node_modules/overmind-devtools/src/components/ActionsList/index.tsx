import { createElement, FunctionComponent } from 'react'
import { useOvermind } from '../../overmind'
import { ActionsListItemType } from '../../overmind/types'
import { nameToColor } from '../../overmind/utils'
import * as textStyles from '../../styles/text'
import * as styles from './styles'
import { css } from 'emotion'

const ActionsList: FunctionComponent = () => {
  const { state, actions } = useOvermind()

  return (
    <div>
      {state.currentApp.actionsList.map((item) => {
        if (item.type === ActionsListItemType.ACTION) {
          const action = state.currentApp.actions[item.id]

          return (
            <div
              className={css(
                styles.actionItem,
                state.currentApp.currentActionId === item.id && styles.selected
              )}
              key={item.id}
              onClick={() => actions.selectAction(item.id)}
            >
              <span
                className={styles.actionColor}
                style={{
                  backgroundColor: nameToColor(action.actionName),
                }}
              />
              <span className={textStyles.denseNormal}>
                {action.actionName}
              </span>
              <span
                className={styles.errorIndication}
                style={{
                  visibility: action.hasError ? 'visible' : 'hidden',
                }}
              />
            </div>
          )
        }
        const mainAction = state.currentApp.actions[item.actionIds[0]]
        const groupedActionIds = item.actionIds.slice(1)

        return (
          <div key={item.id}>
            <div
              className={css(
                styles.actionItem,
                state.currentApp.currentActionId === item.id && styles.selected
              )}
              onClick={() => actions.selectAction(item.id)}
            >
              <span
                className={styles.actionColor}
                style={{ backgroundColor: nameToColor(mainAction.actionName) }}
              />
              <span className={textStyles.denseNormal}>
                {mainAction.actionName} ( {groupedActionIds.length + 1} )
              </span>
            </div>
            {item.isCollapsed
              ? null
              : groupedActionIds.map((actionId) => {
                  const action = state.currentApp.actions[actionId]
                  return (
                    <div
                      className={css(
                        styles.actionSubItem,
                        state.currentApp.currentActionId === actionId &&
                          styles.selected
                      )}
                      key={actionId}
                      onClick={() => actions.selectAction(actionId)}
                    >
                      <span className={textStyles.description}>
                        {action.actionName}
                      </span>
                    </div>
                  )
                })}
          </div>
        )
      })}
    </div>
  )
}

export default ActionsList
