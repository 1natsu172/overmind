import { createElement, FunctionComponent, Fragment } from 'react'
import * as styles from './styles'
import { useOvermind } from '../../overmind'
import { nameToColor } from '../../overmind/utils'

const ActionSelector: FunctionComponent = () => {
  const { state, actions } = useOvermind()
  const app = state.currentApp

  if (app.isQueryingAction) {
    return (
      <div className={styles.wrapper}>
        <div
          className={styles.indicator}
          style={{
            backgroundColor: app.actionQuerySuggestion
              ? nameToColor(app.actionQuerySuggestion)
              : 'transparent',
          }}
        />

        <div className={styles.inputWrapper}>
          <div className={styles.suggestion}>{app.actionQuerySuggestion}</div>
          <input
            autoFocus
            placeholder="Search for action..."
            onBlur={() => actions.toggleQueryingAction()}
            className={styles.input}
            value={app.actionQuery}
            onChange={(event) =>
              actions.changeActionQuery(event.currentTarget.value)
            }
          />
        </div>
        <div className={styles.resultWrapper}>
          {app.actionPaths
            .filter((path) => path.startsWith(app.actionQuery))
            .map((path) => (
              <div
                key={path}
                className={styles.result}
                onMouseDown={() => actions.selectQueryAction(path)}
              >
                <div
                  className={styles.indicator}
                  style={{
                    backgroundColor: nameToColor(path),
                  }}
                />
                {path}
              </div>
            ))}
        </div>
      </div>
    )
  }

  return (
    <div
      className={styles.wrapper}
      onClick={() => actions.toggleQueryingAction()}
    >
      {app.selectedActionQuery ? (
        <Fragment>
          <div
            className={styles.indicator}
            style={{
              backgroundColor: nameToColor(app.selectedActionQuery),
            }}
          />
          <div className={styles.selectedAction}>{app.selectedActionQuery}</div>
        </Fragment>
      ) : (
        <div className={styles.noSelectedAction}>
          Click to select an action...
        </div>
      )}
    </div>
  )
}

export default ActionSelector
